<html>
<head>
<title>Moodlight color picker</title>
</head>
<body>

	<script type="text/javascript" src="jscolor.js"></script>

	Color:
	<input id="colorpicker"
		class="color { pickerOnfocus:false, onImmediateChange:'send_color_change(this);' }"
		value="000000" >

	<a id="colorlink" target="_blank" href="">Link for this color</a>

	<script type="text/javascript">
		window.addEventListener("load", init, false);

		colorpicker = {
			websocket : null
		};

		function init() {
			console.log('init called');
			colorWebSocket();
			
			document.getElementById('colorpicker').color.showPicker();
		}

		function send_color_change(color) {
			var loc = window.location;
			var new_uri;
			new_uri = loc.protocol;
			new_uri += "//" + loc.host + "/set_color/" + color;
			
			document.getElementById('colorlink').href = new_uri;
			
			var strColor = '#' + color;
			document.getElementById('colorlink').innerHTML = strColor.toUpperCase();
			colorpicker.websocket.send(color);
		}

		function colorWebSocket() {
			var loc = window.location;
			var new_uri;
			if (loc.protocol === "https:") {
				new_uri = "wss:";
			} else {
				new_uri = "ws:";
			}
			new_uri += "//" + loc.host + "/websocket/colors/";

			var wsUri = new_uri;

			var websocket = new WebSocket(wsUri);
			websocket.onopen = function(evt) {
			};
			websocket.onclose = function(evt) {
			};
			websocket.onmessage = function(evt) {
			};
			websocket.onerror = function(evt) {
			};

			colorpicker.websocket = websocket;
		}
	</script>

</body>
</html>
