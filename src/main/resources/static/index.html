<html>
<head>
<title>Moodlight color picker</title>
</head>
<body>

	<script type="text/javascript" src="jscolor.js"></script>

	Click here:
	<input class="color" value="66ff00"
		onchange="javascript:send_color_change(this.value)">

	<script type="text/javascript">
		window.addEventListener("load", init, false);

		colorpicker = {
			send_color : function(color) {
				colorpicker.websocket.send(color);
			},
			websocket : null
		};

		function init() {
			console.log('init called');
			colorWebSocket();
		}

		function send_color_change(color) {
			console.log('sending color: ' + color);
			colorpicker.websocket.send(color);
		}

		function colorWebSocket() {
			var loc = window.location;
			var new_uri;
			if (loc.protocol === "https:") {
				new_uri = "wss:";
			} else {
				new_uri = "ws:";
			}
			new_uri += "//" + loc.host + "/websocket/colors/";

			var wsUri = new_uri;

			var websocket = new WebSocket(wsUri);
			websocket.onopen = function(evt) {
				console.log("wscolor open!");
			};
			websocket.onclose = function(evt) {
				console.log("wscolor close!");
			};
			websocket.onmessage = function(evt) {
				console.log("wscolor onmessage!");
			};
			websocket.onerror = function(evt) {
				console.log("wscolor onerror!");
			};

			colorpicker.websocket = websocket;
		}
	</script>

</body>
</html>
